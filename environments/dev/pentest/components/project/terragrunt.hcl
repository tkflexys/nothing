include "module" {
  path = find_in_parent_folders("platform/modules/project_module/module.hcl")
  expose = true
}

include "state" {
  path = "${get_terragrunt_dir()}/../../state.hcl"
  expose = true
  merge_strategy = "no_merge"
}

locals {
  merged_inputs = read_terragrunt_config("./merged_inputs.hcl")
  state_config = {
    backend = "gcs"
    config = {
      prefix  = include.state.locals.state_config.config.prefix
      project = "redacted"
      location = "europe-west2"
      bucket = "redacted"
    }
  }
}

remote_state = local.state_config

generate "backend" {
    path      = "backend.tf"
    if_exists = "overwrite"
    contents = <<EOF
terraform {
  backend "gcs" {}
}
EOF
}